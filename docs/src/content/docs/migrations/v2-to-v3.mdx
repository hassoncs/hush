---
title: "Migration: v2 to v3"
description: Migrating from Hush v2 to v3 - removal of decrypt command
---

import { Aside, Steps } from '@astrojs/starlight/components';

# Migrating from Hush v2 to v3

## Summary

| | |
|---|---|
| **Who's affected** | Users who were using `hush decrypt` or `hush unsafe:decrypt` |
| **Estimated time** | 5 minutes |
| **Config changes** | None - your `hush.yaml` works unchanged |

<Aside type="tip">
If you were already using `hush run` exclusively, no changes are needed. Just update to v3!
</Aside>

## What Changed

### Removed: `hush decrypt` and `hush unsafe:decrypt`

These commands have been **removed entirely** in v3. They were deprecated in v2 because they wrote plaintext secrets to disk, which defeats Hush's "encrypted at rest" security model.

**Why removed:**
- Writing plaintext `.env` files to disk creates security risks
- AI assistants could accidentally read these files
- Secrets should only exist in memory when needed

### What to Use Instead: `hush run`

The `hush run` command decrypts secrets to memory and injects them as environment variables into your command. Secrets never touch the disk.

## Migration Steps

<Steps>

1. **Find usages of `hush decrypt`**
   
   Search your codebase and scripts for:
   - `hush decrypt`
   - `hush unsafe:decrypt`
   - `npx hush decrypt`
   - `npx hush unsafe:decrypt`

2. **Replace with `hush run`**
   
   | Before (v2) | After (v3) |
   |-------------|------------|
   | `hush decrypt && npm start` | `hush run -- npm start` |
   | `hush decrypt -e production && npm build` | `hush run -e production -- npm build` |
   | `hush decrypt && cd api && wrangler dev` | `hush run -t api -- wrangler dev` |

3. **Update CI/CD pipelines**
   
   If your CI was using `hush decrypt`, update it:
   
   ```yaml
   # Before (v2)
   - run: npx hush decrypt -e production
   - run: npm run build
   
   # After (v3)
   - run: npx hush run -e production -- npm run build
   ```

4. **Update any package.json scripts**
   
   ```json
   {
     "scripts": {
       // Before (v2)
       "dev": "hush decrypt && next dev",
       
       // After (v3)
       "dev": "hush run -- next dev"
     }
   }
   ```

5. **Delete any leftover plaintext files**
   
   If you have plaintext `.env.development`, `.env.production`, or `.dev.vars` files that were generated by `hush decrypt`, you can delete them:
   
   ```bash
   rm -f .env.development .env.production .dev.vars
   rm -f packages/*/.env.* packages/*/.dev.vars
   ```
   
   These files are no longer needed - `hush run` handles everything in memory.

</Steps>

## Configuration Unchanged

Your `hush.yaml` configuration file works exactly the same in v3. No changes needed.

The `targets` configuration is still used for:
- **`hush run -t <name>`** - Filter secrets for a specific target
- **`hush push`** - Deploy secrets to Cloudflare Workers
- **`hush resolve`** / **`hush trace`** - Debug secret routing

## Benefits of v3

- **Simpler mental model**: Secrets are always encrypted at rest
- **No cleanup needed**: No plaintext files to delete or gitignore
- **Safer CI/CD**: Secrets exist only in process memory
- **AI-safe by default**: No plaintext files for AI to accidentally read

## Getting Help

If you run into issues migrating:

1. Check `hush status` to verify your setup
2. Use `hush inspect` to see what secrets are available
3. Use `hush run -- env | grep YOUR_VAR` to verify secrets are injected

<Aside type="note">
The targets configuration with `path` and `format` fields is still supported for `hush push` (Cloudflare Workers deployment). You don't need to remove these from your `hush.yaml`.
</Aside>
